# Early prognostic biomarkers of corticosteroid response in severe alcohol-related hepatitis: insights from a retrospective study

This script aims at producing the graphical and statistical outputs presented in the "Early prognostic biomarkers of corticosteroid response in severe alcohol-related hepatitis: insights from a retrospective study " publication by Esparteiro et al. Each output file can be found in output_PR_vs_PNR folder, and the final plots are stored in a corresponding subfolder.

Due to the nature of the analysis performed, two distinct sections are presented. 

Section 1 (Bash scripts, Linux only)

The first section starts using the 53 raw .fastq.gz files that were obtained using metagenomics sequencing and that are available under the BioProject accession number PRJNA1172418. Two different scripts are used for this section.

Script 1 (Preprocessing.sh)

Using a first "Preprocessing.sh" script, the conda environment is prepared for the KneadData + MetaPhlAn pipeline, and may require a few hours due to the downloading of the large MetaPhlAn database. After that first script, the sequencing files can be placed in the "reads/" folder and the second script can be used. To facilitate testing, two example .fastq.gz files from the BB.036 sample are included in the "reads/" folder.

Script 2 (Processing.sh)

This second script requires the fastq.gz files to be downloaded and placed in the "reads/" folder. The sequences are merged, decompressed, filtered using KneadData, aligned using MetaPhlAn, and the resulting tables are merged together in an output that can then be imported in R. 

Section 2 (R scripts, Linux or Windows)

The second section requires the metadata and the data files, data being the object created using the scripts in Section 1. Those objects, alongside a phylogenic tree, are stored in the /data folder. The script "GM_Response.Rmd" is then used to perform the complete analysis of the data and metadata files. A knitted presentation of this .Rmd file is available in "data/GM_Response.pdf". Please note that several at-home functions, stored in the "/functions" folder, are required for the script to run. The variables `age` and `sex` have been randomly altered in this public dataset to prevent potential re-identification of study participants. Therefore, statistical results involving these variables (notably MaAslin2 and correlation analysis) may differ from those obtained with the original data. The full unmodified metadata can be shared confidentially with journal reviewers upon request.

## Structure

- "scripts/": Bash scripts for preprocessing metagenomics data, contains "Preprocessing.sh" and "Processing.sh".
- "data/": Metadata and taxonomic table.
- "functions/": R scripts with helper functions.
- "analysis/": Main R Markdown analysis and the corresponding knitted PDF.
- "output_PR_vs_PNR/": Statistical and graphical outputs generated by the R analysis.
- "reads/": Sequencing reads, in .fastq.gz format, if you want to download them and run this section. Two sequencing files from the BB.036 sample are placed here.

## How to Reproduce
1. (Optional) Download the sequencing files, put them in the current folder in a Bash terminal, run "bash scripts/Preprocessing.sh and then "bash scripts/Processing.sh": data/data_GM_Response.txt is obtained
2. Open "scripts/GM_Response.Rmd" in RStudio and run the code. 
3. The resulting data are then stored in the "output_PR_vs_PNR" folder. 

## Author
Damien Esparteiro